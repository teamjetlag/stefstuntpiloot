<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Hello, World! - A-Frame</title>
    <meta name="description" content="Hello, World! - A-Frame">
    <script src="https://aframe.io/releases/0.4.0/aframe.js"></script>
    <script src="https://unpkg.com/aframe-physics-system@1.2.1/dist/aframe-physics-system.js"></script>
</head>

<body>
    <a-scene physics="debug: true; friction: 0.002;" physics-world="0 -9.8 0">
        <a-entity rotation="-45 0 0" position="0 5 8">
            <a-camera></a-camera>
        </a-entity>
        <a-plane static-body position="0 -1 0" rotation="-90 0 0" width="10" height="10" color="#7BC8A4"></a-plane>
        <!-- Dynamic box -->
        <a-cylinder id="boxA" color="white" static-body position="0 0 0" width="0.5" height="1" depth="0.5"></a-cylinder>
        <!-- Dynamic box -->
        <a-sphere id="boxB" color="red" dynamic-body="mass: 50" position="0 -5 0.2" radius="0.5"></a-sphere>
        
        <!-- <a-entity slider="width: 0.5; height: 0.25; depth: 1; color: orange" position="5 1 0"></a-entity> -->

        <a-entity position="0.85 -0.35 0">
            <a-entity position="2 -2 0" rotation="0 0 25">
                <a-box static-body position="4 0 0.12" depth="0.1" width="3" color="yellow"></a-box>
                <a-box static-body position="4 -0.1 0" depth="0.24" height="0.8" width="3" color="yellow"></a-box>
                <a-box static-body position="4 0 -0.12" depth="0.1" width="3" color="yellow"></a-box>
                <a-box static-body position="2.5 0 0" depth="0.24" height="1.3" width="0.1" color="yellow"></a-box>
            </a-entity>
            <a-cylinder dynamic-body mass="2" position="4.5 0.5 0" color="green" height=0.1 radius="0.4" rotation="0 90 90"></a-cylinder>
            <a-cylinder dynamic-body mass="2" position="5   1   0" color="blue" height=0.1 radius="0.4" rotation="0 90 90"></a-cylinder>
            <a-cylinder dynamic-body mass="2" position="5.5 1.5 0" color="orange" height=0.1 radius="0.4" rotation="0 90 90"></a-cylinder>
        </a-entity>

        <a-entity position="-0.85 -0.35 0">
            <a-entity position="-2 -2 0" rotation="0 0 -25">
               <a-box static-body position="-4 0 0.12" depth="0.1" width="3" color="yellow"></a-box>
                <a-box static-body position="-4 -0.1 0" depth="0.24" height="0.8" width="3" color="yellow"></a-box>
                <a-box static-body position="-4 0 -0.12" depth="0.1" width="3" color="yellow"></a-box>
                <a-box static-body position="-2.5 0 0" depth="0.24" height="1.3" width="0.1" color="yellow"></a-box>
            </a-entity>
            <a-cylinder dynamic-body mass="2" position="-4.5 0.5 0" color="green" height=0.1 radius="0.4" rotation="0 90 90"></a-cylinder>
            <a-cylinder dynamic-body mass="2" position="-5   1   0" color="blue" height=0.1 radius="0.4" rotation="0 90 90"></a-cylinder>
            <a-cylinder dynamic-body mass="2" position="-5.5 1.5 0" color="orange" height=0.1 radius="0.4" rotation="0 90 90"></a-cylinder>
        </a-entity>
        
        <a-entity position="0 -0.35 -0.85">
            <a-entity position="0 -2 -2" rotation="0 90 25">
                <a-box static-body position="4 0 0.12" depth="0.1" width="3" color="yellow"></a-box>
                <a-box static-body position="4 -0.1 0" depth="0.24" height="0.8" width="3" color="yellow"></a-box>
                <a-box static-body position="4 0 -0.12" depth="0.1" width="3" color="yellow"></a-box>
                <a-box static-body position="2.5 0 0" depth="0.24" height="1.3" width="0.1" color="yellow"></a-box>
            </a-entity>
            <a-cylinder dynamic-body mass="2" position="0 0.5 -4.5" color="green" height=0.1 radius="0.4" rotation="0 0 90"></a-cylinder>
            <a-cylinder dynamic-body mass="2" position="0 1   -5" color="blue" height=0.1 radius="0.4" rotation="0 0 90"></a-cylinder>
            <a-cylinder dynamic-body mass="2" position="0 1.5 -5.5" color="orange" height=0.1 radius="0.4" rotation="0 0 90"></a-cylinder>
        </a-entity>

        <a-entity position="0 -0.35 0.85">
            <a-entity position="0 -2 2" rotation="0 -90 25">
                <a-box static-body position="4 0 0.12" depth="0.1" width="3" color="yellow"></a-box>
                <a-box static-body position="4 -0.1 0" depth="0.24" height="0.8" width="3" color="yellow"></a-box>
                <a-box static-body position="4 0 -0.12" depth="0.1" width="3" color="yellow"></a-box>
                <a-box static-body position="2.5 0 0" depth="0.24" height="1.3" width="0.1" color="yellow"></a-box>
            </a-entity>
            <a-cylinder dynamic-body mass="2" position="0 0.5 4.5" color="green" height=0.1 radius="0.4" rotation="0 0 90"></a-cylinder>
            <a-cylinder dynamic-body mass="2" position="0 1   5" color="blue" height=0.1 radius="0.4" rotation="0 0 90"></a-cylinder>
            <a-cylinder dynamic-body mass="2" position="0 1.5 5.5" color="orange" height=0.1 radius="0.4" rotation="0 0 90"></a-cylinder>
        </a-entity>

    </a-scene>
    <script>
    var scene = document.querySelector('a-scene');

    var boxA = document.querySelector('#boxA');
    var boxB = document.querySelector('#boxB');

    scene.addEventListener('loaded', function() {


        var bodyA = boxA.body;
        var pivotA = new CANNON.Vec3().copy(bodyA.position); // Vector from posA perpendicular to axisA

        var bodyB = boxB.body;
        var pivotB = new CANNON.Vec3().copy(bodyB.position); // Vector from posB perpendicular to axisB
        bodyB.inertia.set

        var pointToPointConstraint = new CANNON.PointToPointConstraint(bodyA, pivotA, bodyB, pivotB);
        bodyB.world.addConstraint(pointToPointConstraint);

    });

    scene.addEventListener('click', function() {
        boxB.body.applyImpulse(new CANNON.Vec3(0, 150, 0), new CANNON.Vec3().copy(boxB.getAttribute('position')));
    });


    setInterval(function() {
        var x = boxB.getAttribute('position').x;
        var z = boxB.getAttribute('position').z;
        var f = 10;
        boxB.body.applyImpulse(new CANNON.Vec3(z*f, 0, -x*f), new CANNON.Vec3().copy(boxB.getAttribute('position')));
    }, 1500)
    </script>
</body>

</html>
